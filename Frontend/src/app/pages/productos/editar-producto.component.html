<div class="productos-container">
  <h2>Editar Producto</h2>

  <div *ngIf="loading" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando producto...</p>
  </div>

  <div *ngIf="error" class="loading-container">
    <p style="color: #d32f2f;">{{ error }}</p>
  </div>

  <div class="form-section" *ngIf="!loading && !error">
    <form [formGroup]="productoForm" (ngSubmit)="onSubmit()">

      <fieldset>
        <legend>Información Básica</legend>

        <div class="form-group">
          <div class="input-wrapper">
            <label for="nombre">Nombre *</label>
            <input
              type="text"
              id="nombre"
              formControlName="nombre"
              placeholder="Nombre del producto"
            />
            <small *ngIf="productoForm.get('nombre')?.invalid && productoForm.get('nombre')?.touched"
                   style="color: #d32f2f;">
              El nombre es requerido (mínimo 3 caracteres)
            </small>
          </div>

          <div class="input-wrapper">
            <label for="codigo">Código *</label>
            <input
              type="text"
              id="codigo"
              formControlName="codigo"
              placeholder="Código del producto"
            />
            <small *ngIf="productoForm.get('codigo')?.invalid && productoForm.get('codigo')?.touched"
                   style="color: #d32f2f;">
              El código es requerido (mínimo 3 caracteres)
            </small>
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Información Comercial</legend>

        <div class="form-group">
          <div class="input-wrapper">
            <label for="precio">Precio *</label>
            <input
              type="number"
              id="precio"
              formControlName="precio"
              placeholder="0.00"
              step="0.01"
            />
            <small *ngIf="productoForm.get('precio')?.invalid && productoForm.get('precio')?.touched"
                   style="color: #d32f2f;">
              El precio debe ser mayor a 0
            </small>
          </div>

          <div class="input-wrapper">
            <label for="stock">Stock *</label>
            <input
              type="number"
              id="stock"
              formControlName="stock"
              placeholder="0"
            />
            <small *ngIf="productoForm.get('stock')?.invalid && productoForm.get('stock')?.touched"
                   style="color: #d32f2f;">
              El stock no puede ser negativo
            </small>
          </div>

          <div class="input-wrapper">
            <label for="categoriaId">Categoría *</label>
            <select
              id="categoriaId"
              formControlName="categoriaId"
              class="form-select"
              [class.is-invalid]="productoForm.get('categoriaId')?.invalid && productoForm.get('categoriaId')?.touched">
              <option [value]="null" disabled>Seleccione una categoría</option>
              <option *ngFor="let cat of categorias" [value]="cat.id">
                {{ cat.nombre }}
              </option>
            </select>
            <div class="invalid-feedback" *ngIf="productoForm.get('categoriaId')?.invalid && productoForm.get('categoriaId')?.touched">
              La categoría es obligatoria
            </div>
          </div>

          <div class="input-wrapper">
            <label for="estado">Estado *</label>
            <select
              id="estado"
              formControlName="estado"
            >
              <option value="Activo">Activo</option>
              <option value="Inactivo">Inactivo</option>
            </select>
          </div>
        </div>
      </fieldset>

      <div class="button-group">
        <button type="submit" class="btn-primary" [disabled]="loading || productoForm.invalid">
          {{ loading ? 'Guardando...' : 'Actualizar Producto' }}
        </button>
        <button type="button" class="btn-secondary" (click)="volver()" [disabled]="loading">
          Cancelar
        </button>
      </div>

    </form>
  </div>
</div>
