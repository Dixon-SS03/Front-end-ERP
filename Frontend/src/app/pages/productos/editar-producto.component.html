<div class="page-wrapper">
  <div class="form-container">
    <h2 class="form-title">Editar Producto</h2>

    <div *ngIf="loading" class="loading-message">Cargando producto...</div>
    <div *ngIf="error" class="error-message">{{ error }}</div>

    <form [formGroup]="productoForm" (ngSubmit)="onSubmit()" *ngIf="!loading">

      <div class="form-group">
        <label for="nombre">Nombre *</label>
        <input
          type="text"
          id="nombre"
          formControlName="nombre"
          placeholder="Ingrese el nombre del producto"
          [class.invalid]="productoForm.get('nombre')?.invalid && productoForm.get('nombre')?.touched"
        />
        <span class="error-message" *ngIf="productoForm.get('nombre')?.invalid && productoForm.get('nombre')?.touched">
          El nombre es requerido (mínimo 3 caracteres)
        </span>
      </div>

      <div class="form-group">
        <label for="codigo">Código *</label>
        <input
          type="text"
          id="codigo"
          formControlName="codigo"
          placeholder="Ingrese el código del producto"
          [class.invalid]="productoForm.get('codigo')?.invalid && productoForm.get('codigo')?.touched"
        />
        <span class="error-message" *ngIf="productoForm.get('codigo')?.invalid && productoForm.get('codigo')?.touched">
          El código es requerido (mínimo 3 caracteres)
        </span>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="precio">Precio *</label>
          <input
            type="number"
            id="precio"
            formControlName="precio"
            placeholder="0.00"
            step="0.01"
            min="0"
            [class.invalid]="productoForm.get('precio')?.invalid && productoForm.get('precio')?.touched"
          />
          <span class="error-message" *ngIf="productoForm.get('precio')?.invalid && productoForm.get('precio')?.touched">
            El precio debe ser mayor a 0
          </span>
        </div>

        <div class="form-group">
          <label for="stock">Stock *</label>
          <input
            type="number"
            id="stock"
            formControlName="stock"
            placeholder="0"
            min="0"
            [class.invalid]="productoForm.get('stock')?.invalid && productoForm.get('stock')?.touched"
          />
          <span class="error-message" *ngIf="productoForm.get('stock')?.invalid && productoForm.get('stock')?.touched">
            El stock no puede ser negativo
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="categoriaId">Categoría *</label>
          <select
            id="categoriaId"
            formControlName="categoriaId"
            [class.invalid]="productoForm.get('categoriaId')?.invalid && productoForm.get('categoriaId')?.touched"
          >
            <option [value]="0">Seleccione una categoría</option>
            <option *ngFor="let cat of categorias" [value]="cat.id">
              {{ cat.nombre }}
            </option>
          </select>
          <span class="error-message" *ngIf="productoForm.get('categoriaId')?.invalid && productoForm.get('categoriaId')?.touched">
            Debe seleccionar una categoría
          </span>
        </div>

        <div class="form-group">
          <label for="estado">Estado *</label>
          <select id="estado" formControlName="estado">
            <option value="Activo">Activo</option>
            <option value="Inactivo">Inactivo</option>
          </select>
        </div>
      </div>

      <div class="actions">
        <button type="button" class="btn-secondary" (click)="volver()" [disabled]="loading">
          Cancelar
        </button>
        <button type="submit" class="btn-primary" [disabled]="loading || productoForm.invalid">
          {{ loading ? 'Guardando...' : 'Actualizar Producto' }}
        </button>
      </div>

    </form>
  </div>
</div>
